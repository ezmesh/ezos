<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T-Deck OS Lua API Reference</title>
    <style>
        :root { --bg: #1a1a2e; --fg: #eee; --accent: #00d4ff; --code-bg: #16213e; --border: #0f3460; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--bg); color: var(--fg); line-height: 1.6; margin: 0; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; }
        h1 { color: var(--accent); border-bottom: 2px solid var(--accent); padding-bottom: 10px; }
        h2 { color: var(--accent); margin-top: 40px; }
        h3 { color: #ff6b6b; }
        code { font-family: 'Fira Code', monospace; background: var(--code-bg); padding: 2px 6px; border-radius: 3px; }
        pre { background: var(--code-bg); border: 1px solid var(--border); border-radius: 5px; padding: 15px; overflow-x: auto; }
        pre code { background: none; padding: 0; }
        .func { background: var(--code-bg); border-left: 3px solid var(--accent); padding: 10px 15px; margin: 10px 0; }
        .sig { font-family: monospace; color: var(--accent); font-weight: bold; }
        .desc { margin-top: 5px; color: #ccc; }
        .params { margin: 10px 0; padding-left: 20px; }
        .toc { background: var(--code-bg); padding: 20px; border-radius: 5px; margin: 20px 0; }
        .toc a { color: var(--fg); text-decoration: none; margin-right: 20px; }
        .toc a:hover { color: var(--accent); }
    </style>
</head>
<body>
<div class="container">
<h1>T-Deck OS Lua API Reference</h1>
<p><em>Auto-generated from source code</em></p>

<div class="toc">
<strong>Modules:</strong><br>
<a href="#audio">tdeck.audio</a>
<a href="#crypto">tdeck.crypto</a>
<a href="#display">tdeck.display</a>
<a href="#keyboard">tdeck.keyboard</a>
<a href="#mesh">tdeck.mesh</a>
<a href="#radio">tdeck.radio</a>
<a href="#storage">tdeck.storage</a>
<a href="#system">tdeck.system</a>
</div>
<h2 id="audio">tdeck.audio</h2>
<div class="func">
<div class="sig">tdeck.audio.beep(count, frequency, on_ms, off_ms)</div>
<div class="desc">Play a series of beeps (blocking)</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>count</code>: Number of beeps (default 1)</li>
<li><code>frequency</code>: Tone frequency in Hz (default 1000)</li>
<li><code>on_ms</code>: Beep duration in ms (default 100)</li>
<li><code>off_ms</code>: Pause between beeps in ms (default 50)</li>
</ul></div>
</div>
<div class="func">
<div class="sig">tdeck.audio.get_volume() -&gt; integer</div>
<div class="desc">Get current volume level</div>
<div><strong>Returns:</strong> Volume level 0-100</div>
</div>
<div class="func">
<div class="sig">tdeck.audio.is_playing() -&gt; boolean</div>
<div class="desc">Check if audio is playing</div>
<div><strong>Returns:</strong> true if playing</div>
</div>
<div class="func">
<div class="sig">tdeck.audio.play_sample(filename) -&gt; boolean</div>
<div class="desc">Play a PCM sample file from LittleFS</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>filename</code>: Path to .pcm file (16-bit signed, 22050Hz mono)</li>
</ul></div>
<div><strong>Returns:</strong> true if played successfully</div>
</div>
<div class="func">
<div class="sig">tdeck.audio.play_tone(frequency, duration_ms) -&gt; boolean</div>
<div class="desc">Play a tone for specified duration</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>frequency</code>: Frequency in Hz (20-20000)</li>
<li><code>duration_ms</code>: Duration in milliseconds</li>
</ul></div>
<div><strong>Returns:</strong> true if started successfully</div>
</div>
<div class="func">
<div class="sig">tdeck.audio.set_frequency(frequency) -&gt; boolean</div>
<div class="desc">Set playback frequency for continuous tones</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>frequency</code>: Frequency in Hz (20-20000)</li>
</ul></div>
<div><strong>Returns:</strong> true if valid frequency</div>
</div>
<div class="func">
<div class="sig">tdeck.audio.set_volume(level)</div>
<div class="desc">Set audio volume level</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>level</code>: Volume level 0-100</li>
</ul></div>
</div>
<div class="func">
<div class="sig">tdeck.audio.start()</div>
<div class="desc">Start continuous tone at current frequency</div>
</div>
<div class="func">
<div class="sig">tdeck.audio.stop()</div>
<div class="desc">Stop audio playback</div>
</div>
<h2 id="crypto">tdeck.crypto</h2>
<div class="func">
<div class="sig">tdeck.crypto.aes128_ecb_decrypt(key, ciphertext) -&gt; string</div>
<div class="desc">Decrypt data with AES-128-ECB</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>key</code>: 16-byte key</li>
<li><code>ciphertext</code>: Data to decrypt (must be multiple of 16 bytes)</li>
</ul></div>
<div><strong>Returns:</strong> Decrypted data as binary string (with padding zeros)</div>
</div>
<div class="func">
<div class="sig">tdeck.crypto.aes128_ecb_encrypt(key, plaintext) -&gt; string</div>
<div class="desc">Encrypt data with AES-128-ECB</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>key</code>: 16-byte key</li>
<li><code>plaintext</code>: Data to encrypt (will be zero-padded to block boundary)</li>
</ul></div>
<div><strong>Returns:</strong> Encrypted data as binary string</div>
</div>
<div class="func">
<div class="sig">tdeck.crypto.base64_decode(encoded) -&gt; string</div>
<div class="desc">Decode base64 string to binary data</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>encoded</code>: Base64 encoded string</li>
</ul></div>
<div><strong>Returns:</strong> Binary string, or nil on error</div>
</div>
<div class="func">
<div class="sig">tdeck.crypto.base64_encode(data) -&gt; string</div>
<div class="desc">Encode binary data to base64 string</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>data</code>: Binary string to encode</li>
</ul></div>
<div><strong>Returns:</strong> Base64 encoded string</div>
</div>
<div class="func">
<div class="sig">tdeck.crypto.bytes_to_hex(data) -&gt; string</div>
<div class="desc">Convert binary data to hex string</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>data</code>: Binary string</li>
</ul></div>
<div><strong>Returns:</strong> Hex string (lowercase)</div>
</div>
<div class="func">
<div class="sig">tdeck.crypto.channel_hash(key) -&gt; integer</div>
<div class="desc">Compute channel hash from key (SHA256(key)[0])</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>key</code>: 16-byte channel key</li>
</ul></div>
<div><strong>Returns:</strong> Single byte hash as integer (0-255)</div>
</div>
<div class="func">
<div class="sig">tdeck.crypto.derive_channel_key(input) -&gt; string</div>
<div class="desc">Derive 16-byte channel key from password/name using SHA256</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>input</code>: Password or channel name string</li>
</ul></div>
<div><strong>Returns:</strong> 16-byte key as binary string</div>
</div>
<div class="func">
<div class="sig">tdeck.crypto.hex_to_bytes(hex) -&gt; string</div>
<div class="desc">Convert hex string to binary data</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>hex</code>: Hex string (case-insensitive)</li>
</ul></div>
<div><strong>Returns:</strong> Binary string, or nil on error</div>
</div>
<div class="func">
<div class="sig">tdeck.crypto.hmac_sha256(key, data) -&gt; string</div>
<div class="desc">Compute HMAC-SHA256</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>key</code>: Binary string key</li>
<li><code>data</code>: Binary string to authenticate</li>
</ul></div>
<div><strong>Returns:</strong> 32-byte MAC as binary string</div>
</div>
<div class="func">
<div class="sig">tdeck.crypto.public_channel_key() -&gt; string</div>
<div class="desc">Get the well-known #Public channel key</div>
<div><strong>Returns:</strong> 16-byte key as binary string</div>
</div>
<div class="func">
<div class="sig">tdeck.crypto.random_bytes(count) -&gt; string</div>
<div class="desc">Generate cryptographically secure random bytes</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>count</code>: Number of bytes to generate</li>
</ul></div>
<div><strong>Returns:</strong> Random bytes as binary string</div>
</div>
<div class="func">
<div class="sig">tdeck.crypto.sha256(data) -&gt; string</div>
<div class="desc">Compute SHA-256 hash</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>data</code>: Binary string to hash</li>
</ul></div>
<div><strong>Returns:</strong> 32-byte hash as binary string</div>
</div>
<div class="func">
<div class="sig">tdeck.crypto.sha512(data) -&gt; string</div>
<div class="desc">Compute SHA-512 hash</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>data</code>: Binary string to hash</li>
</ul></div>
<div><strong>Returns:</strong> 64-byte hash as binary string</div>
</div>
<h2 id="display">tdeck.display</h2>
<div class="func">
<div class="sig">tdeck.display.clear()</div>
<div class="desc">Clear display buffer to black</div>
</div>
<div class="func">
<div class="sig">tdeck.display.draw_battery(x, y, percent)</div>
<div class="desc">Draw battery indicator icon</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>x</code>: X position in pixels</li>
<li><code>y</code>: Y position in pixels</li>
<li><code>percent</code>: Battery percentage (0-100)</li>
</ul></div>
</div>
<div class="func">
<div class="sig">tdeck.display.draw_bitmap(x, y, width, height, data)</div>
<div class="desc">Draw a bitmap image from raw RGB565 data</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>x</code>: X position</li>
<li><code>y</code>: Y position</li>
<li><code>width</code>: Bitmap width in pixels</li>
<li><code>height</code>: Bitmap height in pixels</li>
<li><code>data</code>: Raw RGB565 pixel data (2 bytes per pixel, big-endian)</li>
</ul></div>
</div>
<div class="func">
<div class="sig">tdeck.display.draw_bitmap_1bit(x, y, width, height, data, scale, color)</div>
<div class="desc">Draw a 1-bit bitmap with scaling and colorization</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>x</code>: X position</li>
<li><code>y</code>: Y position</li>
<li><code>width</code>: Bitmap width in pixels (original size)</li>
<li><code>height</code>: Bitmap height in pixels (original size)</li>
<li><code>data</code>: Packed 1-bit data (MSB first, row by row)</li>
<li><code>scale</code>: Scale factor (1, 2, 3, etc.) - optional, default 1</li>
<li><code>color</code>: RGB565 color for &quot;on&quot; pixels - optional, default WHITE</li>
</ul></div>
</div>
<div class="func">
<div class="sig">tdeck.display.draw_bitmap_transparent(x, y, width, height, data, transparent_color)</div>
<div class="desc">Draw a bitmap with transparency</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>x</code>: X position</li>
<li><code>y</code>: Y position</li>
<li><code>width</code>: Bitmap width in pixels</li>
<li><code>height</code>: Bitmap height in pixels</li>
<li><code>data</code>: Raw RGB565 pixel data</li>
<li><code>transparent_color</code>: RGB565 color to treat as transparent</li>
</ul></div>
</div>
<div class="func">
<div class="sig">tdeck.display.draw_box(x, y, w, h, title, border_color, title_color)</div>
<div class="desc">Draw bordered box with optional title</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>x</code>: X position in character cells</li>
<li><code>y</code>: Y position in character cells</li>
<li><code>w</code>: Width in character cells</li>
<li><code>h</code>: Height in character cells</li>
<li><code>title</code>: Optional title string</li>
<li><code>border_color</code>: Border color (optional)</li>
<li><code>title_color</code>: Title color (optional)</li>
</ul></div>
</div>
<div class="func">
<div class="sig">tdeck.display.draw_char(x, y, char, color)</div>
<div class="desc">Draw a single character</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>x</code>: X position in pixels</li>
<li><code>y</code>: Y position in pixels</li>
<li><code>char</code>: Character to draw (first char of string)</li>
<li><code>color</code>: Character color (optional)</li>
</ul></div>
</div>
<div class="func">
<div class="sig">tdeck.display.draw_circle(x, y, r, color)</div>
<div class="desc">Draw circle outline</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>x</code>: Center X position</li>
<li><code>y</code>: Center Y position</li>
<li><code>r</code>: Radius</li>
<li><code>color</code>: Circle color (optional)</li>
</ul></div>
</div>
<div class="func">
<div class="sig">tdeck.display.draw_hline(x, y, w, left_connect, right_connect, color)</div>
<div class="desc">Draw horizontal line with optional connectors</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>x</code>: X position in character cells</li>
<li><code>y</code>: Y position in character cells</li>
<li><code>w</code>: Width in character cells</li>
<li><code>left_connect</code>: Connect to left border (optional)</li>
<li><code>right_connect</code>: Connect to right border (optional)</li>
<li><code>color</code>: Line color (optional)</li>
</ul></div>
</div>
<div class="func">
<div class="sig">tdeck.display.draw_indexed_bitmap(x, y, width, height, data, palette)</div>
<div class="desc">Draw a 3-bit indexed bitmap using a color palette</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>x</code>: X position</li>
<li><code>y</code>: Y position</li>
<li><code>width</code>: Bitmap width in pixels</li>
<li><code>height</code>: Bitmap height in pixels</li>
<li><code>data</code>: Packed 3-bit pixel indices (8 pixels packed into 3 bytes)</li>
<li><code>palette</code>: Table of 8 RGB565 color values</li>
</ul></div>
</div>
<div class="func">
<div class="sig">tdeck.display.draw_line(x1, y1, x2, y2, color)</div>
<div class="desc">Draw a line between two points</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>x1</code>: Start X position</li>
<li><code>y1</code>: Start Y position</li>
<li><code>x2</code>: End X position</li>
<li><code>y2</code>: End Y position</li>
<li><code>color</code>: Line color (optional)</li>
</ul></div>
</div>
<div class="func">
<div class="sig">tdeck.display.draw_pixel(x, y, color)</div>
<div class="desc">Draw a single pixel</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>x</code>: X position in pixels</li>
<li><code>y</code>: Y position in pixels</li>
<li><code>color</code>: Pixel color (optional)</li>
</ul></div>
</div>
<div class="func">
<div class="sig">tdeck.display.draw_progress(x, y, w, h, progress, fg_color, bg_color)</div>
<div class="desc">Draw a progress bar</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>x</code>: X position in pixels</li>
<li><code>y</code>: Y position in pixels</li>
<li><code>w</code>: Width in pixels</li>
<li><code>h</code>: Height in pixels</li>
<li><code>progress</code>: Progress value (0.0 to 1.0)</li>
<li><code>fg_color</code>: Foreground color (optional)</li>
<li><code>bg_color</code>: Background color (optional)</li>
</ul></div>
</div>
<div class="func">
<div class="sig">tdeck.display.draw_rect(x, y, w, h, color)</div>
<div class="desc">Draw rectangle outline</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>x</code>: X position in pixels</li>
<li><code>y</code>: Y position in pixels</li>
<li><code>w</code>: Width in pixels</li>
<li><code>h</code>: Height in pixels</li>
<li><code>color</code>: Outline color (optional)</li>
</ul></div>
</div>
<div class="func">
<div class="sig">tdeck.display.draw_round_rect(x, y, w, h, r, color)</div>
<div class="desc">Draw rounded rectangle outline</div>
</div>
<div class="func">
<div class="sig">tdeck.display.draw_signal(x, y, bars)</div>
<div class="desc">Draw signal strength indicator</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>x</code>: X position in pixels</li>
<li><code>y</code>: Y position in pixels</li>
<li><code>bars</code>: Signal strength (0-4 bars)</li>
</ul></div>
</div>
<div class="func">
<div class="sig">tdeck.display.draw_text(x, y, text, color)</div>
<div class="desc">Draw text at pixel coordinates</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>x</code>: X position in pixels</li>
<li><code>y</code>: Y position in pixels</li>
<li><code>text</code>: Text string to draw</li>
<li><code>color</code>: Text color (optional, defaults to TEXT)</li>
</ul></div>
</div>
<div class="func">
<div class="sig">tdeck.display.draw_text_centered(y, text, color)</div>
<div class="desc">Draw horizontally centered text</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>y</code>: Y position in pixels</li>
<li><code>text</code>: Text string to draw</li>
<li><code>color</code>: Text color (optional, defaults to TEXT)</li>
</ul></div>
</div>
<div class="func">
<div class="sig">tdeck.display.draw_triangle(x1, y1, x2, y2, x3, y3, color)</div>
<div class="desc">Draw triangle outline</div>
</div>
<div class="func">
<div class="sig">tdeck.display.fill_circle(x, y, r, color)</div>
<div class="desc">Draw filled circle</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>x</code>: Center X position</li>
<li><code>y</code>: Center Y position</li>
<li><code>r</code>: Radius</li>
<li><code>color</code>: Fill color (optional)</li>
</ul></div>
</div>
<div class="func">
<div class="sig">tdeck.display.fill_rect(x, y, w, h, color)</div>
<div class="desc">Fill a rectangle with color</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>x</code>: X position in pixels</li>
<li><code>y</code>: Y position in pixels</li>
<li><code>w</code>: Width in pixels</li>
<li><code>h</code>: Height in pixels</li>
<li><code>color</code>: Fill color (optional)</li>
</ul></div>
</div>
<div class="func">
<div class="sig">tdeck.display.fill_round_rect(x, y, w, h, r, color)</div>
<div class="desc">Draw filled rounded rectangle</div>
</div>
<div class="func">
<div class="sig">tdeck.display.fill_triangle(x1, y1, x2, y2, x3, y3, color)</div>
<div class="desc">Draw filled triangle</div>
</div>
<div class="func">
<div class="sig">tdeck.display.flush()</div>
<div class="desc">Flush buffer to physical display</div>
</div>
<div class="func">
<div class="sig">tdeck.display.get_cols() -&gt; integer</div>
<div class="desc">Get display columns</div>
<div><strong>Returns:</strong> Number of character columns</div>
</div>
<div class="func">
<div class="sig">tdeck.display.get_font_height() -&gt; integer</div>
<div class="desc">Get font character height</div>
<div><strong>Returns:</strong> Character height in pixels</div>
</div>
<div class="func">
<div class="sig">tdeck.display.get_font_width() -&gt; integer</div>
<div class="desc">Get font character width</div>
<div><strong>Returns:</strong> Character width in pixels</div>
</div>
<div class="func">
<div class="sig">tdeck.display.get_height() -&gt; integer</div>
<div class="desc">Get display height</div>
<div><strong>Returns:</strong> Height in pixels</div>
</div>
<div class="func">
<div class="sig">tdeck.display.get_rows() -&gt; integer</div>
<div class="desc">Get display rows</div>
<div><strong>Returns:</strong> Number of character rows</div>
</div>
<div class="func">
<div class="sig">tdeck.display.get_width() -&gt; integer</div>
<div class="desc">Get display width</div>
<div><strong>Returns:</strong> Width in pixels</div>
</div>
<div class="func">
<div class="sig">tdeck.display.rgb(r, g, b) -&gt; integer</div>
<div class="desc">Convert RGB to RGB565 color value</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>r</code>: Red component (0-255)</li>
<li><code>g</code>: Green component (0-255)</li>
<li><code>b</code>: Blue component (0-255)</li>
</ul></div>
<div><strong>Returns:</strong> RGB565 color value</div>
</div>
<div class="func">
<div class="sig">tdeck.display.set_brightness(level)</div>
<div class="desc">Set backlight brightness</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>level</code>: Brightness level (0-255)</li>
</ul></div>
</div>
<div class="func">
<div class="sig">tdeck.display.set_font_size(size)</div>
<div class="desc">Set font size</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>size</code>: Font size string: &quot;tiny&quot;, &quot;small&quot;, &quot;medium&quot;, or &quot;large&quot;</li>
</ul></div>
</div>
<div class="func">
<div class="sig">tdeck.display.text_width(text) -&gt; integer</div>
<div class="desc">Get pixel width of text string</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>text</code>: Text string to measure</li>
</ul></div>
<div><strong>Returns:</strong> Width in pixels</div>
</div>
<h2 id="keyboard">tdeck.keyboard</h2>
<div class="func">
<div class="sig">tdeck.keyboard.available() -&gt; boolean</div>
<div class="desc">Check if a key is waiting</div>
<div><strong>Returns:</strong> true if a key is available to read</div>
</div>
<div class="func">
<div class="sig">tdeck.keyboard.get_adaptive_scrolling() -&gt; boolean</div>
<div class="desc">Check if adaptive scrolling is enabled</div>
<div><strong>Returns:</strong> true if adaptive scrolling is on</div>
</div>
<div class="func">
<div class="sig">tdeck.keyboard.get_backlight() -&gt; integer</div>
<div class="desc">Get current keyboard backlight level</div>
<div><strong>Returns:</strong> Backlight level (0-255, 0 = off)</div>
</div>
<div class="func">
<div class="sig">tdeck.keyboard.get_mode() -&gt; string</div>
<div class="desc">Get current keyboard input mode</div>
<div><strong>Returns:</strong> &quot;normal&quot; or &quot;raw&quot;</div>
</div>
<div class="func">
<div class="sig">tdeck.keyboard.get_raw_matrix_bits() -&gt; integer</div>
<div class="desc">Get full matrix state as 64-bit integer (raw mode)</div>
<div><strong>Returns:</strong> 49-bit value (7 cols Ã— 7 rows), bits 0-6 = col 0, bits 7-13 = col 1, etc.</div>
</div>
<div class="func">
<div class="sig">tdeck.keyboard.get_repeat_delay() -&gt; integer</div>
<div class="desc">Get initial delay before key repeat starts</div>
<div><strong>Returns:</strong> Delay in milliseconds</div>
</div>
<div class="func">
<div class="sig">tdeck.keyboard.get_repeat_enabled() -&gt; boolean</div>
<div class="desc">Check if key repeat is enabled</div>
<div><strong>Returns:</strong> true if key repeat is enabled</div>
</div>
<div class="func">
<div class="sig">tdeck.keyboard.get_repeat_rate() -&gt; integer</div>
<div class="desc">Get key repeat rate (interval between repeats)</div>
<div><strong>Returns:</strong> Rate in milliseconds</div>
</div>
<div class="func">
<div class="sig">tdeck.keyboard.get_trackball_mode() -&gt; string</div>
<div class="desc">Get current trackball input mode</div>
<div><strong>Returns:</strong> &quot;polling&quot; or &quot;interrupt&quot;</div>
</div>
<div class="func">
<div class="sig">tdeck.keyboard.get_trackball_sensitivity() -&gt; integer</div>
<div class="desc">Get trackball sensitivity level</div>
<div><strong>Returns:</strong> Sensitivity value</div>
</div>
<div class="func">
<div class="sig">tdeck.keyboard.has_trackball() -&gt; boolean</div>
<div class="desc">Check if device has trackball</div>
<div><strong>Returns:</strong> true if trackball is available</div>
</div>
<div class="func">
<div class="sig">tdeck.keyboard.is_alt_held() -&gt; boolean</div>
<div class="desc">Check if Alt is currently held</div>
<div><strong>Returns:</strong> true if Alt is held</div>
</div>
<div class="func">
<div class="sig">tdeck.keyboard.is_ctrl_held() -&gt; boolean</div>
<div class="desc">Check if Ctrl is currently held</div>
<div><strong>Returns:</strong> true if Ctrl is held</div>
</div>
<div class="func">
<div class="sig">tdeck.keyboard.is_fn_held() -&gt; boolean</div>
<div class="desc">Check if Fn is currently held</div>
<div><strong>Returns:</strong> true if Fn is held</div>
</div>
<div class="func">
<div class="sig">tdeck.keyboard.is_key_pressed(col, row) -&gt; boolean</div>
<div class="desc">Check if a specific matrix key is pressed (raw mode)</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>col</code>: Column index (0-4)</li>
<li><code>row</code>: Row index (0-6)</li>
</ul></div>
<div><strong>Returns:</strong> true if key is pressed</div>
</div>
<div class="func">
<div class="sig">tdeck.keyboard.is_shift_held() -&gt; boolean</div>
<div class="desc">Check if Shift is currently held</div>
<div><strong>Returns:</strong> true if Shift is held</div>
</div>
<div class="func">
<div class="sig">tdeck.keyboard.read() -&gt; table</div>
<div class="desc">Read next key event (non-blocking)</div>
<div><strong>Returns:</strong> Key event table or nil if no key available</div>
</div>
<div class="func">
<div class="sig">tdeck.keyboard.read_blocking(timeout_ms) -&gt; table</div>
<div class="desc">Read key with optional timeout (blocking)</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>timeout_ms</code>: Timeout in milliseconds (0 = forever)</li>
</ul></div>
<div><strong>Returns:</strong> Key event table or nil on timeout</div>
</div>
<div class="func">
<div class="sig">tdeck.keyboard.read_raw_code() -&gt; integer|nil</div>
<div class="desc">Read raw key code byte directly from I2C (no translation)</div>
<div><strong>Returns:</strong> Raw byte (0x00-0xFF) or nil if no key available</div>
</div>
<div class="func">
<div class="sig">tdeck.keyboard.read_raw_matrix() -&gt; table|nil</div>
<div class="desc">Read raw key matrix state (only works in raw mode)</div>
<div><strong>Returns:</strong> Table of 7 bytes (one per column, 7 bits = rows), or nil on error</div>
</div>
<div class="func">
<div class="sig">tdeck.keyboard.set_adaptive_scrolling(enabled)</div>
<div class="desc">Enable or disable adaptive scrolling</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>enabled</code>: true to enable, false to disable</li>
</ul></div>
</div>
<div class="func">
<div class="sig">tdeck.keyboard.set_backlight(level)</div>
<div class="desc">Set keyboard backlight brightness</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>level</code>: Brightness level (0-255, 0 = off)</li>
</ul></div>
</div>
<div class="func">
<div class="sig">tdeck.keyboard.set_mode(mode) -&gt; boolean</div>
<div class="desc">Set keyboard input mode</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>mode</code>: &quot;normal&quot; or &quot;raw&quot;</li>
</ul></div>
<div><strong>Returns:</strong> true if mode was set successfully</div>
</div>
<div class="func">
<div class="sig">tdeck.keyboard.set_repeat_delay(delay_ms)</div>
<div class="desc">Set initial delay before key repeat starts</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>delay_ms</code>: Delay in milliseconds (typically 200-800)</li>
</ul></div>
</div>
<div class="func">
<div class="sig">tdeck.keyboard.set_repeat_enabled(enabled)</div>
<div class="desc">Enable or disable key repeat</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>enabled</code>: true to enable, false to disable</li>
</ul></div>
</div>
<div class="func">
<div class="sig">tdeck.keyboard.set_repeat_rate(rate_ms)</div>
<div class="desc">Set key repeat rate (interval between repeats)</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>rate_ms</code>: Rate in milliseconds (typically 20-100)</li>
</ul></div>
</div>
<div class="func">
<div class="sig">tdeck.keyboard.set_trackball_mode(mode)</div>
<div class="desc">Set trackball input mode</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>mode</code>: &quot;polling&quot; or &quot;interrupt&quot;</li>
</ul></div>
</div>
<div class="func">
<div class="sig">tdeck.keyboard.set_trackball_sensitivity(value)</div>
<div class="desc">Set trackball sensitivity level</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>value</code>: Sensitivity value</li>
</ul></div>
</div>
<h2 id="mesh">tdeck.mesh</h2>
<div class="func">
<div class="sig">tdeck.mesh.build_packet(route_type, payload_type, payload, path) -&gt; string|nil</div>
<div class="desc">Build a raw mesh packet for transmission</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>route_type</code>: Route type constant (FLOOD=1, DIRECT=2)</li>
<li><code>payload_type</code>: Payload type constant (ADVERT=4, GRP_TXT=5, etc.)</li>
<li><code>payload</code>: Binary string payload</li>
<li><code>path</code>: Optional binary string of path hashes (default: empty)</li>
</ul></div>
<div><strong>Returns:</strong> Serialized packet as binary string, or nil on error</div>
</div>
<div class="func">
<div class="sig">tdeck.mesh.calc_shared_secret(other_pub_key) -&gt; string|nil</div>
<div class="desc">Calculate ECDH shared secret with another node</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>other_pub_key</code>: 32-byte Ed25519 public key of the other party</li>
</ul></div>
<div><strong>Returns:</strong> 32-byte shared secret as binary string, or nil on error</div>
</div>
<div class="func">
<div class="sig">tdeck.mesh.clear_packet_queue()</div>
<div class="desc">Clear all packets from the queue</div>
</div>
<div class="func">
<div class="sig">tdeck.mesh.clear_tx_queue()</div>
<div class="desc">Clear all packets from transmit queue</div>
</div>
<div class="func">
<div class="sig">tdeck.mesh.ed25519_sign(data) -&gt; signature</div>
<div class="desc">Sign data with this node&#x27;s private key</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>data</code>: Binary string to sign</li>
</ul></div>
<div><strong>Returns:</strong> 64-byte Ed25519 signature as binary string, or nil on error</div>
</div>
<div class="func">
<div class="sig">tdeck.mesh.ed25519_verify(data, signature, pub_key) -&gt; boolean</div>
<div class="desc">Verify an Ed25519 signature</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>data</code>: Binary string that was signed</li>
<li><code>signature</code>: 64-byte Ed25519 signature</li>
<li><code>pub_key</code>: 32-byte Ed25519 public key</li>
</ul></div>
<div><strong>Returns:</strong> true if signature is valid</div>
</div>
<div class="func">
<div class="sig">tdeck.mesh.enable_packet_queue(enabled)</div>
<div class="desc">Enable or disable packet queuing for polling</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>enabled</code>: Boolean to enable/disable</li>
</ul></div>
</div>
<div class="func">
<div class="sig">tdeck.mesh.get_node_count() -&gt; integer</div>
<div class="desc">Get number of known nodes</div>
<div><strong>Returns:</strong> Node count</div>
</div>
<div class="func">
<div class="sig">tdeck.mesh.get_node_id() -&gt; string</div>
<div class="desc">Get this node&#x27;s full ID</div>
<div><strong>Returns:</strong> 6-byte hex string</div>
</div>
<div class="func">
<div class="sig">tdeck.mesh.get_node_name() -&gt; string</div>
<div class="desc">Get this node&#x27;s display name</div>
<div><strong>Returns:</strong> Node name string</div>
</div>
<div class="func">
<div class="sig">tdeck.mesh.get_nodes() -&gt; table</div>
<div class="desc">Get list of discovered mesh nodes</div>
<div><strong>Returns:</strong> Array of node tables with path_hash, name, rssi, snr, last_seen, hops, pub_key_hex</div>
</div>
<div class="func">
<div class="sig">tdeck.mesh.get_path_check() -&gt; boolean</div>
<div class="desc">Get current path check setting</div>
<div><strong>Returns:</strong> true if path check is enabled</div>
</div>
<div class="func">
<div class="sig">tdeck.mesh.get_path_hash() -&gt; integer</div>
<div class="desc">Get this node&#x27;s path hash (first byte of public key)</div>
<div><strong>Returns:</strong> Path hash as integer (0-255)</div>
</div>
<div class="func">
<div class="sig">tdeck.mesh.get_public_key() -&gt; string</div>
<div class="desc">Get this node&#x27;s public key as binary string</div>
<div><strong>Returns:</strong> 32-byte Ed25519 public key</div>
</div>
<div class="func">
<div class="sig">tdeck.mesh.get_public_key_hex() -&gt; string</div>
<div class="desc">Get this node&#x27;s public key as hex string</div>
<div><strong>Returns:</strong> 64-character hex string</div>
</div>
<div class="func">
<div class="sig">tdeck.mesh.get_rx_count() -&gt; integer</div>
<div class="desc">Get total packets received</div>
<div><strong>Returns:</strong> Receive count</div>
</div>
<div class="func">
<div class="sig">tdeck.mesh.get_short_id() -&gt; string</div>
<div class="desc">Get this node&#x27;s short ID</div>
<div><strong>Returns:</strong> 3-byte hex string (6 chars)</div>
</div>
<div class="func">
<div class="sig">tdeck.mesh.get_tx_count() -&gt; integer</div>
<div class="desc">Get total packets transmitted</div>
<div><strong>Returns:</strong> Transmit count</div>
</div>
<div class="func">
<div class="sig">tdeck.mesh.get_tx_queue_capacity() -&gt; integer</div>
<div class="desc">Get maximum transmit queue capacity</div>
<div><strong>Returns:</strong> Max queue size</div>
</div>
<div class="func">
<div class="sig">tdeck.mesh.get_tx_queue_size() -&gt; integer</div>
<div class="desc">Get number of packets waiting in transmit queue</div>
<div><strong>Returns:</strong> Queue size</div>
</div>
<div class="func">
<div class="sig">tdeck.mesh.get_tx_throttle() -&gt; integer</div>
<div class="desc">Get current throttle interval</div>
<div><strong>Returns:</strong> Milliseconds between transmissions</div>
</div>
<div class="func">
<div class="sig">tdeck.mesh.has_packets() -&gt; boolean</div>
<div class="desc">Check if packets are available in the queue</div>
<div><strong>Returns:</strong> true if one or more packets are queued</div>
</div>
<div class="func">
<div class="sig">tdeck.mesh.is_initialized() -&gt; boolean</div>
<div class="desc">Check if mesh networking is initialized</div>
<div><strong>Returns:</strong> true if mesh is ready</div>
</div>
<div class="func">
<div class="sig">tdeck.mesh.is_tx_queue_full() -&gt; boolean</div>
<div class="desc">Check if transmit queue is full</div>
<div><strong>Returns:</strong> true if queue is full</div>
</div>
<div class="func">
<div class="sig">tdeck.mesh.make_header(route_type, payload_type, version) -&gt; integer</div>
<div class="desc">Create a packet header byte from components</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>route_type</code>: Route type constant</li>
<li><code>payload_type</code>: Payload type constant</li>
<li><code>version</code>: Optional version (default: 0)</li>
</ul></div>
<div><strong>Returns:</strong> Header byte as integer</div>
</div>
<div class="func">
<div class="sig">tdeck.mesh.on_group_packet(callback)</div>
<div class="desc">Set callback for raw group packets (before C++ decryption)</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>callback</code>: Function(packet_table) called with {channel_hash, data, sender_hash, rssi, snr}</li>
</ul></div>
</div>
<div class="func">
<div class="sig">tdeck.mesh.on_node_discovered(callback)</div>
<div class="desc">Set callback for node discovery</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>callback</code>: Function(node_table) called when node discovered</li>
</ul></div>
</div>
<div class="func">
<div class="sig">tdeck.mesh.on_packet(callback)</div>
<div class="desc">Set callback for ALL incoming packets (called before C++ handling)</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>callback</code>: Function(packet_table) returning handled, rebroadcast booleans</li>
</ul></div>
</div>
<div class="func">
<div class="sig">tdeck.mesh.packet_count() -&gt; integer</div>
<div class="desc">Get number of packets in queue</div>
<div><strong>Returns:</strong> Number of queued packets</div>
</div>
<div class="func">
<div class="sig">tdeck.mesh.parse_header(header_byte) -&gt; route_type, payload_type, version</div>
<div class="desc">Parse a packet header byte into components</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>header_byte</code>: Single byte header value</li>
</ul></div>
<div><strong>Returns:</strong> route_type, payload_type, version as integers</div>
</div>
<div class="func">
<div class="sig">tdeck.mesh.pop_packet() -&gt; table|nil</div>
<div class="desc">Get and remove the next packet from queue</div>
<div><strong>Returns:</strong> Packet table or nil if queue is empty</div>
</div>
<div class="func">
<div class="sig">tdeck.mesh.queue_send(data) -&gt; boolean</div>
<div class="desc">Queue packet for transmission (throttled, non-blocking)</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>data</code>: Binary string of serialized packet</li>
</ul></div>
<div><strong>Returns:</strong> true if queued successfully, false if queue full or error</div>
</div>
<div class="func">
<div class="sig">tdeck.mesh.schedule_rebroadcast(data)</div>
<div class="desc">Schedule raw packet data for rebroadcast</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>data</code>: Binary string of raw packet bytes</li>
</ul></div>
</div>
<div class="func">
<div class="sig">tdeck.mesh.send_announce() -&gt; boolean</div>
<div class="desc">Broadcast node announcement</div>
<div><strong>Returns:</strong> true if sent successfully</div>
</div>
<div class="func">
<div class="sig">tdeck.mesh.send_group_packet(channel_hash, encrypted_data) -&gt; boolean</div>
<div class="desc">Send raw encrypted group packet</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>channel_hash</code>: Single byte channel identifier</li>
<li><code>encrypted_data</code>: Pre-encrypted payload (MAC + ciphertext)</li>
</ul></div>
<div><strong>Returns:</strong> true if sent successfully</div>
</div>
<div class="func">
<div class="sig">tdeck.mesh.send_raw(data) -&gt; boolean</div>
<div class="desc">Send raw packet data directly via radio (bypasses queue, immediate)</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>data</code>: Binary string of serialized packet</li>
</ul></div>
<div><strong>Returns:</strong> true if sent successfully</div>
</div>
<div class="func">
<div class="sig">tdeck.mesh.set_node_name(name) -&gt; boolean</div>
<div class="desc">Set this node&#x27;s display name</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>name</code>: New node name</li>
</ul></div>
<div><strong>Returns:</strong> true if successful</div>
</div>
<div class="func">
<div class="sig">tdeck.mesh.set_path_check(enabled)</div>
<div class="desc">Enable or disable path check for flood routing</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>enabled</code>: Boolean - when true, packets with our hash in path are skipped</li>
</ul></div>
</div>
<div class="func">
<div class="sig">tdeck.mesh.set_tx_throttle(ms)</div>
<div class="desc">Set minimum interval between transmissions</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>ms</code>: Milliseconds between transmissions (default 100)</li>
</ul></div>
</div>
<div class="func">
<div class="sig">tdeck.mesh.update()</div>
<div class="desc">Process incoming mesh packets</div>
</div>
<h2 id="radio">tdeck.radio</h2>
<div class="func">
<div class="sig">tdeck.radio.available() -&gt; boolean</div>
<div class="desc">Check if data is available</div>
<div><strong>Returns:</strong> true if packet waiting</div>
</div>
<div class="func">
<div class="sig">tdeck.radio.get_config() -&gt; table</div>
<div class="desc">Get current radio configuration</div>
<div><strong>Returns:</strong> Table with frequency, bandwidth, spreading_factor, etc.</div>
</div>
<div class="func">
<div class="sig">tdeck.radio.get_last_rssi() -&gt; number</div>
<div class="desc">Get last received signal strength</div>
<div><strong>Returns:</strong> RSSI in dBm</div>
</div>
<div class="func">
<div class="sig">tdeck.radio.get_last_snr() -&gt; number</div>
<div class="desc">Get last signal-to-noise ratio</div>
<div><strong>Returns:</strong> SNR in dB</div>
</div>
<div class="func">
<div class="sig">tdeck.radio.is_busy() -&gt; boolean</div>
<div class="desc">Check if radio is busy</div>
<div><strong>Returns:</strong> true if transmitting or receiving</div>
</div>
<div class="func">
<div class="sig">tdeck.radio.is_initialized() -&gt; boolean</div>
<div class="desc">Check if radio is initialized</div>
<div><strong>Returns:</strong> true if radio is ready</div>
</div>
<div class="func">
<div class="sig">tdeck.radio.is_receiving() -&gt; boolean</div>
<div class="desc">Check if in receive mode</div>
<div><strong>Returns:</strong> true if listening</div>
</div>
<div class="func">
<div class="sig">tdeck.radio.is_transmitting() -&gt; boolean</div>
<div class="desc">Check if currently transmitting</div>
<div><strong>Returns:</strong> true if transmission in progress</div>
</div>
<div class="func">
<div class="sig">tdeck.radio.receive() -&gt; string, number, number</div>
<div class="desc">Receive a packet</div>
<div><strong>Returns:</strong> Data string, RSSI, SNR or nil if no data</div>
</div>
<div class="func">
<div class="sig">tdeck.radio.send(data) -&gt; string</div>
<div class="desc">Transmit data</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>data</code>: String or table of bytes to send</li>
</ul></div>
<div><strong>Returns:</strong> Result string</div>
</div>
<div class="func">
<div class="sig">tdeck.radio.set_bandwidth(khz) -&gt; string</div>
<div class="desc">Set radio bandwidth</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>khz</code>: Bandwidth in kHz</li>
</ul></div>
<div><strong>Returns:</strong> Result string</div>
</div>
<div class="func">
<div class="sig">tdeck.radio.set_coding_rate(cr) -&gt; string</div>
<div class="desc">Set LoRa coding rate</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>cr</code>: Coding rate (5-8)</li>
</ul></div>
<div><strong>Returns:</strong> Result string</div>
</div>
<div class="func">
<div class="sig">tdeck.radio.set_frequency(mhz) -&gt; string</div>
<div class="desc">Set radio frequency</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>mhz</code>: Frequency in MHz</li>
</ul></div>
<div><strong>Returns:</strong> Result string (ok, error_init, etc.)</div>
</div>
<div class="func">
<div class="sig">tdeck.radio.set_spreading_factor(sf) -&gt; string</div>
<div class="desc">Set LoRa spreading factor</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>sf</code>: Spreading factor (6-12)</li>
</ul></div>
<div><strong>Returns:</strong> Result string</div>
</div>
<div class="func">
<div class="sig">tdeck.radio.set_sync_word(sw) -&gt; string</div>
<div class="desc">Set sync word</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>sw</code>: Sync word value</li>
</ul></div>
<div><strong>Returns:</strong> Result string</div>
</div>
<div class="func">
<div class="sig">tdeck.radio.set_tx_power(dbm) -&gt; string</div>
<div class="desc">Set transmit power</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>dbm</code>: Power in dBm (0-22)</li>
</ul></div>
<div><strong>Returns:</strong> Result string</div>
</div>
<div class="func">
<div class="sig">tdeck.radio.sleep() -&gt; string</div>
<div class="desc">Put radio into sleep mode</div>
<div><strong>Returns:</strong> Result string</div>
</div>
<div class="func">
<div class="sig">tdeck.radio.start_receive() -&gt; string</div>
<div class="desc">Start listening for packets</div>
<div><strong>Returns:</strong> Result string</div>
</div>
<div class="func">
<div class="sig">tdeck.radio.wake() -&gt; string</div>
<div class="desc">Wake radio from sleep</div>
<div><strong>Returns:</strong> Result string</div>
</div>
<h2 id="storage">tdeck.storage</h2>
<div class="func">
<div class="sig">tdeck.storage.append_file(path, content) -&gt; boolean</div>
<div class="desc">Append content to file</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>path</code>: File path</li>
<li><code>content</code>: Content to append</li>
</ul></div>
<div><strong>Returns:</strong> true if successful</div>
</div>
<div class="func">
<div class="sig">tdeck.storage.clear_prefs() -&gt; boolean</div>
<div class="desc">Clear all preferences</div>
<div><strong>Returns:</strong> true if cleared</div>
</div>
<div class="func">
<div class="sig">tdeck.storage.exists(path) -&gt; boolean</div>
<div class="desc">Check if file or directory exists</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>path</code>: Path to check</li>
</ul></div>
<div><strong>Returns:</strong> true if exists</div>
</div>
<div class="func">
<div class="sig">tdeck.storage.file_size(path) -&gt; integer</div>
<div class="desc">Get file size in bytes</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>path</code>: File path (prefix /sd/ for SD card)</li>
</ul></div>
<div><strong>Returns:</strong> File size or nil with error message</div>
</div>
<div class="func">
<div class="sig">tdeck.storage.get_flash_info() -&gt; table</div>
<div class="desc">Get flash storage info</div>
<div><strong>Returns:</strong> Table with total_bytes, used_bytes, free_bytes</div>
</div>
<div class="func">
<div class="sig">tdeck.storage.get_pref(key, default) -&gt; string</div>
<div class="desc">Get preference value</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>key</code>: Preference key</li>
<li><code>default</code>: Default value if not found</li>
</ul></div>
<div><strong>Returns:</strong> Stored value or default</div>
</div>
<div class="func">
<div class="sig">tdeck.storage.get_sd_info() -&gt; table</div>
<div class="desc">Get SD card info</div>
<div><strong>Returns:</strong> Table with total_bytes, used_bytes, free_bytes or nil</div>
</div>
<div class="func">
<div class="sig">tdeck.storage.is_sd_available() -&gt; boolean</div>
<div class="desc">Check if SD card is mounted</div>
<div><strong>Returns:</strong> true if SD card available</div>
</div>
<div class="func">
<div class="sig">tdeck.storage.json_decode(json_string) -&gt; value</div>
<div class="desc">Decode JSON string to Lua value</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>json_string</code>: JSON string</li>
</ul></div>
<div><strong>Returns:</strong> Lua value or nil on error</div>
</div>
<div class="func">
<div class="sig">tdeck.storage.json_encode(value) -&gt; string</div>
<div class="desc">Encode Lua value to JSON string</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>value</code>: Lua table, string, number, boolean, or nil</li>
</ul></div>
<div><strong>Returns:</strong> JSON string or nil on error</div>
</div>
<div class="func">
<div class="sig">tdeck.storage.list_dir(path) -&gt; table</div>
<div class="desc">List directory contents</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>path</code>: Directory path (default &quot;/&quot;)</li>
</ul></div>
<div><strong>Returns:</strong> Array of tables with name, is_dir, size</div>
</div>
<div class="func">
<div class="sig">tdeck.storage.mkdir(path) -&gt; boolean</div>
<div class="desc">Create directory</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>path</code>: Directory path</li>
</ul></div>
<div><strong>Returns:</strong> true if created</div>
</div>
<div class="func">
<div class="sig">tdeck.storage.read_bytes(path, offset, length) -&gt; string</div>
<div class="desc">Read bytes from file at specific offset (for random access)</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>path</code>: File path (prefix /sd/ for SD card)</li>
<li><code>offset</code>: Byte offset to start reading from</li>
<li><code>length</code>: Number of bytes to read</li>
</ul></div>
<div><strong>Returns:</strong> Binary data as string, or nil with error message</div>
</div>
<div class="func">
<div class="sig">tdeck.storage.read_file(path) -&gt; string</div>
<div class="desc">Read entire file contents</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>path</code>: File path (prefix /sd/ for SD card)</li>
</ul></div>
<div><strong>Returns:</strong> File content or nil, error_message</div>
</div>
<div class="func">
<div class="sig">tdeck.storage.remove(path) -&gt; boolean</div>
<div class="desc">Delete a file</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>path</code>: File path to delete</li>
</ul></div>
<div><strong>Returns:</strong> true if deleted</div>
</div>
<div class="func">
<div class="sig">tdeck.storage.remove_pref(key) -&gt; boolean</div>
<div class="desc">Remove a preference</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>key</code>: Preference key to remove</li>
</ul></div>
<div><strong>Returns:</strong> true if removed</div>
</div>
<div class="func">
<div class="sig">tdeck.storage.rename(old_path, new_path) -&gt; boolean</div>
<div class="desc">Rename or move a file</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>old_path</code>: Current path</li>
<li><code>new_path</code>: New path</li>
</ul></div>
<div><strong>Returns:</strong> true if renamed</div>
</div>
<div class="func">
<div class="sig">tdeck.storage.rmdir(path) -&gt; boolean</div>
<div class="desc">Remove empty directory</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>path</code>: Directory path</li>
</ul></div>
<div><strong>Returns:</strong> true if removed</div>
</div>
<div class="func">
<div class="sig">tdeck.storage.set_pref(key, value) -&gt; boolean</div>
<div class="desc">Set preference value</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>key</code>: Preference key</li>
<li><code>value</code>: Value to store</li>
</ul></div>
<div><strong>Returns:</strong> true if saved successfully</div>
</div>
<div class="func">
<div class="sig">tdeck.storage.write_file(path, content) -&gt; boolean</div>
<div class="desc">Write content to file (creates/overwrites)</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>path</code>: File path</li>
<li><code>content</code>: Content to write</li>
</ul></div>
<div><strong>Returns:</strong> true if successful, or false with error</div>
</div>
<h2 id="system">tdeck.system</h2>
<div class="func">
<div class="sig">tdeck.system.cancel_timer(timer_id)</div>
<div class="desc">Cancel a scheduled timer</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>timer_id</code>: ID returned by set_timer or set_interval</li>
</ul></div>
</div>
<div class="func">
<div class="sig">tdeck.system.chip_model() -&gt; string</div>
<div class="desc">Get ESP32 chip model name</div>
<div><strong>Returns:</strong> Chip model string</div>
</div>
<div class="func">
<div class="sig">tdeck.system.cpu_freq() -&gt; integer</div>
<div class="desc">Get CPU frequency</div>
<div><strong>Returns:</strong> Frequency in MHz</div>
</div>
<div class="func">
<div class="sig">tdeck.system.delay(ms)</div>
<div class="desc">Blocking delay execution</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>ms</code>: Delay duration in milliseconds (max 60000)</li>
</ul></div>
</div>
<div class="func">
<div class="sig">tdeck.system.gc()</div>
<div class="desc">Force full garbage collection</div>
</div>
<div class="func">
<div class="sig">tdeck.system.gc_step(steps) -&gt; integer</div>
<div class="desc">Perform incremental garbage collection</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>steps</code>: Number of GC steps (default 10)</li>
</ul></div>
<div><strong>Returns:</strong> Result from lua_gc</div>
</div>
<div class="func">
<div class="sig">tdeck.system.get_battery_percent() -&gt; integer</div>
<div class="desc">Get battery charge level</div>
<div><strong>Returns:</strong> Battery percentage (0-100)</div>
</div>
<div class="func">
<div class="sig">tdeck.system.get_battery_voltage() -&gt; number</div>
<div class="desc">Get battery voltage</div>
<div><strong>Returns:</strong> Estimated battery voltage in volts</div>
</div>
<div class="func">
<div class="sig">tdeck.system.get_firmware_info() -&gt; table</div>
<div class="desc">Get firmware partition info</div>
<div><strong>Returns:</strong> Table with partition_size, app_size, free_bytes</div>
</div>
<div class="func">
<div class="sig">tdeck.system.get_free_heap() -&gt; integer</div>
<div class="desc">Get free internal RAM</div>
<div><strong>Returns:</strong> Free heap memory in bytes</div>
</div>
<div class="func">
<div class="sig">tdeck.system.get_free_psram() -&gt; integer</div>
<div class="desc">Get free PSRAM</div>
<div><strong>Returns:</strong> Free PSRAM in bytes</div>
</div>
<div class="func">
<div class="sig">tdeck.system.get_last_error() -&gt; string</div>
<div class="desc">Get last Lua error message</div>
<div><strong>Returns:</strong> Error message or nil if no error</div>
</div>
<div class="func">
<div class="sig">tdeck.system.get_lua_memory() -&gt; integer</div>
<div class="desc">Get memory used by Lua runtime</div>
<div><strong>Returns:</strong> Memory usage in bytes</div>
</div>
<div class="func">
<div class="sig">tdeck.system.get_time() -&gt; table|nil</div>
<div class="desc">Get current wall clock time</div>
<div><strong>Returns:</strong> Table with hour, minute, second, or nil if time not set</div>
</div>
<div class="func">
<div class="sig">tdeck.system.get_time_unix() -&gt; integer</div>
<div class="desc">Get current Unix timestamp</div>
<div><strong>Returns:</strong> Unix timestamp (seconds since 1970-01-01), or 0 if time not set</div>
</div>
<div class="func">
<div class="sig">tdeck.system.get_timezone() -&gt; integer</div>
<div class="desc">Get current timezone UTC offset in hours</div>
<div><strong>Returns:</strong> UTC offset in hours</div>
</div>
<div class="func">
<div class="sig">tdeck.system.get_total_heap() -&gt; integer</div>
<div class="desc">Get total heap size</div>
<div><strong>Returns:</strong> Total heap memory in bytes</div>
</div>
<div class="func">
<div class="sig">tdeck.system.get_total_psram() -&gt; integer</div>
<div class="desc">Get total PSRAM size</div>
<div><strong>Returns:</strong> Total PSRAM in bytes</div>
</div>
<div class="func">
<div class="sig">tdeck.system.is_low_memory() -&gt; boolean</div>
<div class="desc">Check if memory is critically low</div>
<div><strong>Returns:</strong> true if less than 32KB available</div>
</div>
<div class="func">
<div class="sig">tdeck.system.is_sd_available() -&gt; boolean</div>
<div class="desc">Check if SD card is available</div>
<div><strong>Returns:</strong> true if SD card is present and accessible</div>
</div>
<div class="func">
<div class="sig">tdeck.system.is_usb_msc_active() -&gt; boolean</div>
<div class="desc">Check if USB MSC mode is active</div>
<div><strong>Returns:</strong> true if MSC mode is active</div>
</div>
<div class="func">
<div class="sig">tdeck.system.log(message)</div>
<div class="desc">Log message to serial output</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>message</code>: Text to log</li>
</ul></div>
</div>
<div class="func">
<div class="sig">tdeck.system.millis() -&gt; integer</div>
<div class="desc">Returns milliseconds since boot</div>
<div><strong>Returns:</strong> Milliseconds elapsed since device started</div>
</div>
<div class="func">
<div class="sig">tdeck.system.reload_scripts() -&gt; boolean</div>
<div class="desc">Reload all Lua scripts (hot reload)</div>
<div><strong>Returns:</strong> true if successful</div>
</div>
<div class="func">
<div class="sig">tdeck.system.restart()</div>
<div class="desc">Restart the device</div>
</div>
<div class="func">
<div class="sig">tdeck.system.set_interval(ms, callback) -&gt; integer</div>
<div class="desc">Schedule a repeating callback</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>ms</code>: Interval between calls (minimum 10ms)</li>
<li><code>callback</code>: Function to call repeatedly</li>
</ul></div>
<div><strong>Returns:</strong> Timer ID for cancellation</div>
</div>
<div class="func">
<div class="sig">tdeck.system.set_time(year, month, day, hour, minute, second) -&gt; boolean</div>
<div class="desc">Set system clock time</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>year</code>: Full year (e.g., 2024)</li>
<li><code>month</code>: Month (1-12)</li>
<li><code>day</code>: Day of month (1-31)</li>
<li><code>hour</code>: Hour (0-23)</li>
<li><code>minute</code>: Minute (0-59)</li>
<li><code>second</code>: Second (0-59)</li>
</ul></div>
<div><strong>Returns:</strong> true if time was set successfully</div>
</div>
<div class="func">
<div class="sig">tdeck.system.set_time_unix(timestamp) -&gt; boolean</div>
<div class="desc">Set system clock from Unix timestamp</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>timestamp</code>: Unix timestamp (seconds since 1970-01-01)</li>
</ul></div>
<div><strong>Returns:</strong> true if time was set successfully</div>
</div>
<div class="func">
<div class="sig">tdeck.system.set_timer(ms, callback) -&gt; integer</div>
<div class="desc">Schedule a one-shot callback</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>ms</code>: Delay before callback fires</li>
<li><code>callback</code>: Function to call</li>
</ul></div>
<div><strong>Returns:</strong> Timer ID for cancellation</div>
</div>
<div class="func">
<div class="sig">tdeck.system.set_timezone(tz_string) -&gt; boolean</div>
<div class="desc">Set timezone using POSIX TZ string</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>tz_string</code>: POSIX timezone string (e.g., &quot;CET-1CEST,M3.5.0,M10.5.0/3&quot;)</li>
</ul></div>
<div><strong>Returns:</strong> true if timezone was set successfully</div>
</div>
<div class="func">
<div class="sig">tdeck.system.start_usb_msc() -&gt; boolean</div>
<div class="desc">Start USB Mass Storage mode to access SD card from PC</div>
<div><strong>Returns:</strong> true if started successfully</div>
</div>
<div class="func">
<div class="sig">tdeck.system.stop_usb_msc()</div>
<div class="desc">Stop USB Mass Storage mode</div>
</div>
<div class="func">
<div class="sig">tdeck.system.uptime() -&gt; integer</div>
<div class="desc">Get device uptime</div>
<div><strong>Returns:</strong> Seconds since boot</div>
</div>
<div class="func">
<div class="sig">tdeck.system.yield(ms)</div>
<div class="desc">Yield execution to allow C++ background tasks to run</div>
<div class="params"><strong>Parameters:</strong><ul>
<li><code>ms</code>: Optional sleep time in milliseconds (default 1, max 100)</li>
</ul></div>
</div>

<hr>
<p style="text-align: center; color: #666;">Auto-generated Lua API Documentation</p>
</div>
</body>
</html>